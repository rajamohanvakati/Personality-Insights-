public class IBMWatsonPersonalTwitter {
    Private String userIds {get;set;}
    public Contact c{get;set;}
    public String jsonData{get;set;}
    public JSON2Apex apexCls{get;set;} 
    public IBMWatsonPersonalTwitter(ApexPages.StandardController con){
        userIds = con.getId() ; 
        c =[Select Id , Name,Twitter_Name__c from Contact where id=:userIds] ;
        callWatsonToneAnalyser(c);
        apexCls = parse(jsonData);
    }
    public static String createAuthHeader(String username, String password){
        Blob headerValue = Blob.valueOf(username + ':' + password);
        String authorizationHeader = 'Basic ' + EncodingUtil.base64Encode(headerValue);
        return authorizationHeader;
    }
    public  void callWatsonToneAnalyser(Contact c) {
        HttpRequest req = new HttpRequest();
        req.setEndpoint('callout:IBM_Watson_Personality_Insight/v3/profile?version=2016-10-20&consumption_preferences=true&raw_scores=true');
        req.setHeader('Content-Type', 'application/json');
        req.setBody(stringToJSON(c.Twitter_Name__c));
        req.setMethod('POST');
        Http http = new Http();
        HTTPResponse res = http.send(req);
        jsonData = res.getBody();
    }
    
    private String stringToJSON(String  userTweets) {
        List<TwitterResponse> responce = TwitterHandler.getTwitterDetails(userTweets);
        List<ContentItemsJSON.contentItem> contentItems =  new List<ContentItemsJSON.contentItem>();
        for(TwitterResponse tweet : responce){
            ContentItemsJSON.contentItem contentItem = new ContentItemsJSON.contentItem();
            contentItem.id = tweet.id_str;
            contentItem.userid = userTweets;
            contentItem.sourceid = 'twitter';
            contentItem.created = (Integer)Datetime.now().getTime();
            contentItem.updated = (Integer)Datetime.now().getTime();
            contentItem.contenttype = 'text/plain';
            contentItem.charset = 'UTF-8';
            contentItem.language = 'en-us';
            contentItem.content = tweet.text;
            contentItem.parentid = '';
            contentItem.reply = false;
            contentItem.forward = false;
            contentItems.add(contentItem);
        }
        
        
        
        JSONGenerator generator = JSON.createGenerator(true);
        generator.writeStartObject();
        generator.writeObjectField('contentItems', contentItems);
        generator.writeEndObject();
        String body = generator.getAsString();
        jsonData = body;
        System.debug('body'+body);
        
        
        return body;
        //  return TwitterHandler.getTwitterDetails(c.Twitter_Name__c);
    }
    //
    // Generated by JSON2Apex http://json2apex.herokuapp.com/
    //
    
    
    
    public class Consumption_preferences {
        public String consumption_preference_id;
        public String name;
        public Double score;
    }
    
    public class JSON2Apex {
        public Integer word_count;
        public String processed_language;
        public List<Personality> personality{get;set;}
        public List<Children> needs;
        public List<Children> values;
        public List<Behavior> behavior{get;set;}
        public List<Consumption_preferences_Z> consumption_preferences{get;set;}
        public List<Warnings> warnings;
    }
    
    public class Consumption_preferences_Z {
        public String consumption_preference_category_id;
        public String name;
        public List<Consumption_preferences> consumption_preferences;
    }
    
    public class Personality {
        public String trait_id;
        public String name{get;set;}
        public String category{get;set;}
        public Double percentile{get;set;}
        public Double raw_score{get;set;}
        public List<Children> children;
    }
    
    public class Children {
        public String trait_id;
        public String name;
        public String category;
        public Double percentile;
        public Double raw_score;
    }
    
    public class Behavior {
        public String trait_id {get;set;}
        public String name {get;set;}
        public String category {get;set;}
        public Double percentage {get;set;}
    }
    
    public class Warnings {
    }
    
    
    public static JSON2Apex parse(String json) {
        return (JSON2Apex) System.JSON.deserialize(json, JSON2Apex.class);
    }
    
    
}